Reconstruction of local frequencies for recovering the unwrapped phase in optical interferometry
In optics, when interferograms or digital holograms are recorded and their phase is recovered, it is common to obtain a wrapped phase with some errors, noise and artifacts such as singularities due to the non linearities of the demodulation process. This paper shows how to reconstruct the frequency field of the wrapped phase by using adaptive Gabor filters. Gabor filters are Gaussian quadrature filters tuned in at a certain frequency. We adapt these Gabor filters by tuning them locally and estimating the frequency using wrapped finite differences of the estimated phase. Doing this process iteratively, the frequency estimation is refined and smoothed. The unwrapped phase is easily recovered by integrating the recovered frequency field using, for example, a simple line raster integration. We don’t have problems with phase inconsistencies or residues while integrating the phase, because these are removed. The obtained unwrapped phase is clean, consistent and practically error-free. We show estimation errors with simulated data and the performance of the proposed method using real-world recorded wavefronts.
Today, in optical interferometry one can find dozens of papers showing how to recover the wrapped phase from a single interferogram with or without frequency carrier, or by using two or more phase-shifted interferograms, see refs 1,2,3 for a review. When the interferograms are free of noise, have high contrast and homogeneous illumination, these demodulation methods recover an ideal wrapped phase4,5,6. However under real laboratory conditions, for example when using speckle interferometry or shearography, we are far from these ideal conditions7,8,9,10,11,12. Instead, the wavefront recovered is a wrapped phase with imperfections like noise, miscalibration errors and artifacts that introduce phase inconsistencies or residues (singularities). These inconsistencies make the phase unwrapping process difficult, because the unwrapping is an integration of wrapped phase differences and this integration becomes path-dependent13,14,15,16. For the wrapped phase to be consistent, its wrapped differences must obey the following second order cross difference relation:
where Δ
x
 and Δ
y
 are the wrapped difference operator along x and y respectively. The wrapped difference operator, at a certain site x, is defined as the modulus 2π of the phase difference between the phase at x and its neighbor x − 1, assuming backward differences. When the wrapped differences obey Eq. (1), the phase unwrapping process is path-independent. The question is how can we estimate the wrapped differences in such a way that inconsistencies or residues are removed. What we are going to propose in this paper is based on the reconstruction of the noise-free frequency field, which is taken as the wrapped differences of the phase along x and y. Thus, given the wrapped phase with noise and miscalibration errors, we want to obtain the best possible estimation of the frequency field without noise and inconsistencies, in such a way that its integration becomes path-independent, so that one is able to unwrap the phase with simple line scanning integration.
There are two published methods that are related to the approach presented here. One is the work of ref. 16 in which the residual error between the observed wrapped phase and an estimated unwrapped and re-wrapped one, is iteratively approximated using a smoothed frequency field (where the smoothing is performed using a Total Variation (TV) scheme) which is then integrated to obtain the phase. This permits one to obtain a good approximation to the unwrapped phase, although the unwrapped phase is recovered with noise and inconsistencies. The other is the work of ref. 17 in which an estimation for the frequency field of an observed interferogram is obtained via a fixed bank of Gabor quadrature filters which filter the noise, and permit the estimation of the local frequency as the tuning frequency of the filter with maximal response. These two methods will be analyzed in more detail in the Discussion section.
In the method presented here, we also focus in the processing of the frequency field. The main difference in our work is that we propose the use of a linear filter whose tuning frequency is continuously adapted to the local frequency field, which allows for a better noise elimination, so that stable results may be obtained at very low signal to noise ratios. In particular, our proposal is to use a linear system whose impulse response is a Gabor filter tuned at the local frequency that is obtained from the wrapped phase. In the following sections we will show how the frequency field is estimated and used to tune the Gabor filters at each pixel and how the frequency reconstruction and smoothing is accomplished by using an iterative process involving the application of the adaptive Gabor filters and a smooth estimation of the frequency field using wrapped differences. We remark that just a few iterations of this process are needed to obtain a clean and consistent frequency field. Finally, the unwrapped phase is easily obtained after integration.
For the simulated tests we present here, we take the Root Mean Square Error (RMSE) to measure the error as:
where \(\hat{u}(x,y)\), \(u(x,y)\), \(\hat{v}(x,y)\), and \(v(x,y)\), are the frequency estimation and corresponding ground truth along x and y, respectively. M and N denote the number of rows and columns of the lattice (x, y) for the wrapped phase images.
First we show how the method presented here removes the miscalibration errors. For example, in phase shifting interferometry, error sources of miscalibration are very common when the step of the phase shift is not given correctly or when the phase shifting algorithms are not tuned to the frequency step of the interferograms. We simulated a wrapped phase image using Eq. (2) without noise, taking \(\varphi (x,y)=1.5\times {10}^{-3}((x-{\mathrm{128)}}^{2}+{(y-128)}^{2})\) in a lattice of M × N = 256 × 256 pixels and miscalibration error of c = 0.8. In theory, the frequency fields are two ramps, one in x and another in y with slope of 3 × 10−3 each one. Usin the Eq. (14), we set the filter parameters to σ = s = 5.5 for the Gabor and Gaussian filter, respectively, and performed 5 iterations. In Fig. 3(A) we show the simulated wrapped phase and Fig. 3(B,C) shows the frequency field taken as the wrapped differences of the simulated phase using Eq. (4). In Fig. 3(D) we show the obtained phase after frequency reconstruction and smoothing. The phase is recovered unwrapped but we show it wrapped for comparison purposes. The reconstructed frequency field is shown in Fig. 3(E,F). Compare the frequency field of B and C with the reconstructed frequency field of E and F in the figure. In B and C one can see the effect of the miscalibration error which is removed in E and F. The graph on the right, shows the central row of both unwrapped phases, the one with miscalibration errors and the one recovered after integrating the reconstructed frequency field. In the table shown below the graph, we can see that the miscalibration error is reduced by at least two orders of magnitude.
Wrapped phase with miscalibration errors. In (A) we see the wrapped phase, (B and C) show the x and y frequency fields. In (D). We show the recovered phase after frequency reconstruction and integration. The phase is shown wrapped for comparison proposes. In (E and F) we show the reconstructed frequencies. The graph at the right shows a plot of the central row of the unwrapped input and the unwrapped output of images (A and D) respectively. Color bars show the dynamic range of the images.
The second test shows how we can reconstruct the frequency field and obtain a clean unwrapped phase under different levels of noise, which we measure using the Signal to Noise Ratio (SNR). In this case, due to the noise, we split the iterations in two: first we perform 3 iterations with σ = 1.0 for the Gabor filter and s = 4.3 for smoothing the frequencies, then, we perform 3 more iterations setting σ = s = 4.3, according to Eq. (14), for doing a total of 6 iterations. We do it in this way because experimentally we found that for noisy phase maps one can obtain a better estimation for the local frequencies by relaxing the Gabor filtering with an small σ in order to get the detail of the local frequencies, then, set σ = s of the Gabor filter to filter out noise.
For this test, we simulated a wrapped phase as
where \(Is(x,y)=\,\sin \,[\varphi (x,y)]+\eta (x,y)\) and \(Ic(x,y)=\,\cos \,[\varphi (x,y)]+\eta (x,y)\). The scalar field η(x, y) is Gaussian noise with mean zero and variance σ

n
, the argument ϕ(x, y) is the ground true phase for which we take the same model used in ref. 16, which is:
where x, y ∈ [−1, 1]2, and we take ϕ
0 = 20 and a = 0.3, in a lattice of M × N 
                        = 201 × 201 pixels. The SNR of the signals Ic and Is is measured as 1/σ

n
 since the variance of the cosine and sine functions is one. As already said, the parameter σ

n
 corresponds to the variance of the noise, which is normally distributed. In Fig. 4 we show the result of this test for levels of SNR = 1.3, 1.0, 0.5 and 0.2. In row Input we show the noisy fringe pattern I

c
 that modulates the phase of Eq. (19), in row Filtered we show the wrapped phase obtained at end of the process iterations, in row Unwrapped we show the unwrapped phase we obtain after intergrating the reconstructed frequency field and row Error map shows the error obtained for each pixel as the difference between the obtained unwrapped phase and the ground true phase. Note that the error is localized mostly near the peaks of the phase, due to the reduction in dynamic range caused by the smoothing process; this reduction is in all cases less 10% of the total dynamic range of the unwrapped phase.
Test with four different levels of noise. The image columns show the test for SNR = 0.2, 0.5, 1.0 and 1.3 as depicted. The rows show the noisy fringe pattern, the obtained filtered phase, unwrapped phase and the error map. The color bars indicate the dynamic range of the images. The error map is the error (in radians) we obtain for each pixel by taking the difference of the obtained unwrapped phase and the ground true phase.
To see how accurate the reconstruction is, we used the same simulated phase of Fig. 4 and tested our method with 29 different levels of SNR from SNR = 0.2 to SNR = 3.0. For each level of noise, we ran 100 different realizations, reconstructed the phase and took the RMSE. The mean of the RMSE and standard deviation for each level of noise is shown in the error graph of Fig. 5. There we can see that the error is small and decreases proportionally with the level of noise. The variance of the RMSE let us see the stability of our method. For the case of SNR = 0.2, the variance is greater but consider that SNR = 0.2 is a very high leve of noise. These tests were made in a computer with 4xIntel® Core i5-6300U CPU @ 2.4 GHz and 16 Gb of RAM. The mean processing time for each image was of 2.882 sec. The results shown here were obtained using double precision arithmetic.
Graph of the Root Mean Square Error (RMSE) and standard deviation (vertical bars) for SNR levels from 0.3 to 3. The mean and standard deviation of the RMSE was taken from 100 different realizations for each level of SNR.
In the examples we have presented, we assume that the wrapped phase map is the only data available, and that it follows the model of Eq. (2) and showed that our method obtains stable results for SNR >0.2, as shown in Fig. 5. However, in most cases we may have access to the interferograms from which the phase was obtained. We now show that in this case the noise tolerance of our method may increase. As an example, consider the case of Phase Shifting Interferometry (PSI). In this case, we have a sequence of interferograms which may be modeled as:
In particular, we consider the same example used in Fig. 6 of ref. 16, so that a comparison may be established between the performance of both methodologies. Therefore, as in ref. 16 we use N = 4, α = π/2, additive white Gaussian noise, and the same definition for the phase (see Eq. (19)), to obtain a four-step phase shifting sequence of interferograms. In this case, we can obtain a complex signal by combining them in the following way (derived from the standard 4-step phase recovery algorithm8):
Result obtained by using the four interferograms of a four-step PSI sequence. The first image is the first fringe pattern of the 4-steps sequence; the second image is the wrapped phase obtained from the 4-step algorithm; the third image is the filtered wrapped phase we obtain, denoted here as G{ϕ

W
(x, y)}, and the fourth image is the corresponding unwrapped phase. The signal to noise ratio of interferograms is SNR = 0.08. The color bars indicate the dynamic range of the images.
Using this complex signal in our reconstruction method, instead of the complex signal of Eq. (3), the method is more robust and can deal with interferograms with SNR as low as 0.08, while in the case of the experiment reported in ref. 16, their method becomes unstable for SNR = 0.3. In Fig. 6, we show the first interferogram of the sequence described above with SNR = 0.08, which is lower than the SNR used in Fig. 4. Using the complex signal (21) and following our method, with the same iterations and parameters as described for the test of Fig. 4, we obtained a cleaner phase (comparing with the input). This is appreciated in the last two images of Fig. 6.
To perform a fair comparison with the work presented in ref. 16, we programmed that method as described in that work so that we could reproduce their results, and then compared the RMSE for as defined in Eq. (17) with our approach. We ran this test for 29 different levels of noise from SNR = 0.2, to 3.0 with steps of 0.1 with the same test image shown in Fig. 4. For each noised simulated wrapped phase, we applied the method described in ref. 16. and the one described here. In Fig. 7 we show the RMSE in logarithmic scale of both methods for each level of noise. We used the logarithmic scale for clarity. As one can see, with the approach presented one obtains a RMSE at least two orders of magnitude smaller than the one obtained with the approach presented in ref. 16 (see Discussion section).
The graph shows the error obtained using the Adaptive Gabor Filters (AGF) approach, shown here, and the TV filtering approach shown in ref. 16. For clarity, the error is in logarithmic scale.
In the last test, we used three different wrapped phases obtained from real optical experiments using speckle interferometry.
In Fig. 8 we show the results. The inputs for these tests are affected by speckle noise and miscalibration errors. The miscalibration error is evident in the test shown in the middle row if you compare how it is seen in Fig. 3. In the column Reconstruction we can see the recovered wrapped phase obtained by integrating the reconstructed frequency field. In the column Unwrapped we show the unwrapped phase obtained after integrating the frequency field. As one can see, the final unwrapped phase is obtained clean without detuning errors. The sizes of each wrapped phase image given as input are 246 × 527, 480 × 610 and 482 × 641, respectively. As with the test of Fig. 4, we made 6 iterations in total of our method. The first 3 iterations are with parameters σ = 1.0 and s = 11.3 and the next tree iterations are with parameters σ = s = 11.3. As before, the parameters s and σ are set according to Eq. (14), using N = 527, which is the width of the first wrapped phase of Fig. 8. Note that as we said, it is not necessary to use the precise values given by Eq. 14; the intermediate value we use gives good results in all these cases.
Test using real laboratory experiments. The first column shows the input, the second column shows the filtered wrapped phase and last column shows the corresponding unwrapped phase. All experiments are from speckle interferometry.
We have presented a simple and computationally efficient method for the accurate reconstruction of the frequency field from the noisy wrapped phase which is obtained from optical experiments. From this denoised frequency field the clean unwrapped phase may be easily obtained by path-independent integration.
The basis of the method is the use of an adaptive linear quadrature filter which permits very good noise elimination. The method makes the implicit assumption that the true unwrapped phase is smooth. If this holds, one can obtain better denoising performance than that of even non-linear wide passband methods. This is important because, as we have seen here, the problem of phase unwrapping may be complicated due to the presence of noise which induces inconsistencies in the corresponding frequency field. In16, the approach is by approximating in an iterative way the residual error between the observed wrapped phase and an estimated one, which is obtained by integrating a TV-smoothed frequency field. To summarize the method we developed a block diagram for each iteration which is presented in Fig. 9. One problem with this method is that when one adds to the current unwrapped estimator \({\hat{\varphi }}_{W}\) the final estimated wrapped residual error R

w
 between the observed wrapped phase and the re-wrapped \({\hat{\varphi }}_{W}\), one effectively obtains an unwrapped phase that is appropriately unwrapped, but with the original (wrapped) noise added back to it. As a result, the performance of the method decreases sharply as the SNR diminishes. In contrast, in our approach all the noise is progressively eliminated from the estimated unwrapped phase by means of the adaptive Gabor filter, which explains the big difference in RMS error between the two approaches, which is observed in Fig. 7. It should be noted however, that for high SNR, the method in16 will give very good results because adding the final residual R

w
 permits the full preservation of the phase dynamic range, while in our approach it may be slightly compressed due to the smoothing process. For the same reasons, the method in ref. 16 may be more adequate for the unwrapping of discontinuous phase maps, since in our approach the discontinuities may be smoothed out to some degree.
Block diagram of the method presented in ref. 16. As with our method, the gradient is taken by means of finite differences. As recommended in ref. 16. we use 500 iterations in the experiment reported here.
Also related to the approach presented here is the work of ref. 17. There, a local frequency map is estimated by passing an observed interferogram through a fixed bank of Gabor filters and then estimating the local frequency as the tuning frequency of the filter with maximal response. Some problems with this approach are its sensitivity to noise and the fact that since the estimated frequency is restricted to the discrete set of tuning frequencies of the filter bank, one always gets a quantization error which is inversely proportional to the number of filters in the bank, and hence, to the computational complexity. In contrast, in our approach we start with the observed wrapped phase map and estimate the local frequency as the phase gradient; this estimate is progressively refined through the iterations of the method, and used to tune local Gabor filters that eliminate noise, until one finally gets a high-precision, smoothly-varying frequency map, which is then used to find a clean, inconsistency-free unwrapped phase map.
Our method may be very useful in optical applications, such as interferometry, shearography and digital holography, as well as in other areas, such as fringe projection for 3-D reconstruction of smooth objects. In many of these instances, the reconstruction problem is difficult due to the presence of speckle noise and miscalibration errors; as we have shown, our method presents an excellent performance in these cases. However, if there are many true phase discontinuities present, as is the case, for example, in Synthetic Aperture Radar (SAR) images of urban landscapes, other methods, perhaps based on the TV functional, or dedicated algorithms19, 20 may be more adequate.
